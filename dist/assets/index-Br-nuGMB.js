var m=Object.defineProperty;var w=(a,e,t)=>e in a?m(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var h=(a,e,t)=>w(a,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();class y{constructor(e,t,i,s,r,n,l=1){h(this,"x");h(this,"y");h(this,"width");h(this,"height");h(this,"velocity");h(this,"currentLevel");h(this,"canvasWidth");this.x=e,this.y=t,this.width=i,this.height=s,this.velocity=r,this.canvasWidth=n,this.currentLevel=l}move(e,t){const i=this.velocity*t;e==="left"?this.x=Math.max(0,this.x-i):e==="right"&&(this.x=Math.min(this.canvasWidth-this.width,this.x+i))}setLevel(e){this.currentLevel=e}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}draw(e){e.fillStyle="rgba(255, 255, 255, 0.8)",e.fillRect(this.x,this.y,this.width,this.height)}updateCanvasWidth(e){this.canvasWidth=e,this.x=Math.min(this.x,this.canvasWidth-this.width)}}class p{constructor(e,t,i=80,s=20){h(this,"x");h(this,"y");h(this,"width");h(this,"height");h(this,"isActive");this.x=e,this.y=t,this.width=i,this.height=s,this.isActive=!0}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}checkOverlap(e){const t=e.getBounds(),i=this.getBounds(),s=t.x+t.width/2,r=t.y+t.height;return this.isActive&&s>=i.x&&s<=i.x+i.width&&r>=i.y&&r<=i.y+i.height}}class L{constructor(e,t,i=40,s=50){h(this,"x");h(this,"y");h(this,"width");h(this,"height");h(this,"collected");this.x=e,this.y=t,this.width=i,this.height=s,this.collected=!1}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}checkCollision(e){if(this.collected)return!1;const t=e.getBounds(),i=this.getBounds();return t.x<i.x+i.width&&t.x+t.width>i.x&&t.y<i.y+i.height&&t.y+t.height>i.y}}class b{constructor(){h(this,"keys");h(this,"activeDirection");h(this,"enterPressed");h(this,"keydownHandler");h(this,"keyupHandler");this.keys=new Map,this.activeDirection=null,this.enterPressed=!1,this.keydownHandler=this.handleKeyDown.bind(this),this.keyupHandler=this.handleKeyUp.bind(this)}initialize(){window.addEventListener("keydown",this.keydownHandler),window.addEventListener("keyup",this.keyupHandler)}cleanup(){window.removeEventListener("keydown",this.keydownHandler),window.removeEventListener("keyup",this.keyupHandler)}handleKeyDown(e){const t=e.key;(t==="ArrowLeft"||t==="ArrowRight")&&(e.preventDefault(),this.keys.get(t)||(this.keys.set(t,!0),t==="ArrowLeft"?this.activeDirection="left":t==="ArrowRight"&&(this.activeDirection="right"))),t==="Enter"&&(e.preventDefault(),this.enterPressed=!0)}handleKeyUp(e){const t=e.key;(t==="ArrowLeft"||t==="ArrowRight")&&(e.preventDefault(),this.keys.set(t,!1),t==="ArrowLeft"&&this.activeDirection==="left"?this.keys.get("ArrowRight")?this.activeDirection="right":this.activeDirection=null:t==="ArrowRight"&&this.activeDirection==="right"&&(this.keys.get("ArrowLeft")?this.activeDirection="left":this.activeDirection=null)),t==="Enter"&&(e.preventDefault(),this.enterPressed=!1)}isKeyPressed(e){return this.keys.get(e)||!1}getActiveDirection(){return this.activeDirection}isEnterPressed(){return this.enterPressed}consumeEnter(){this.enterPressed=!1}update(){}}class T{constructor(e,t){h(this,"canvasWidth");h(this,"canvasHeight");h(this,"waterLevel");this.canvasWidth=e,this.canvasHeight=t,this.waterLevel=t*.1}drawBackground(e,t){const i=this.canvasWidth,s=this.canvasHeight;if(t===1){const r=e.createLinearGradient(0,0,0,this.waterLevel);r.addColorStop(0,"#87CEEB"),r.addColorStop(1,"#B0E0E6"),e.fillStyle=r,e.fillRect(0,0,i,this.waterLevel),this.drawIcebergLevel1(e,i)}else{const r=e.createLinearGradient(0,this.waterLevel,0,s);r.addColorStop(0,"#4682B4"),r.addColorStop(.5,"#1E3A5F"),r.addColorStop(1,"#0F1F3F"),e.fillStyle=r,e.fillRect(0,0,i,s),this.drawIcebergLevel2(e,i,s)}}drawIcebergLevel1(e,t){const i=t/2,s=0,r=this.waterLevel;e.fillStyle="#E0F2F7",e.beginPath(),e.moveTo(i-t*.15,s),e.lineTo(i+t*.15,s),e.lineTo(i+t*.25,r),e.lineTo(i-t*.25,r),e.closePath(),e.fill(),e.fillStyle="#B8D8E0",e.beginPath(),e.moveTo(i,s),e.lineTo(i+t*.15,s),e.lineTo(i+t*.25,r),e.lineTo(i,r),e.closePath(),e.fill()}drawIcebergLevel2(e,t,i){const s=t/2,r=this.waterLevel,n=i;e.fillStyle="rgba(224, 242, 247, 0.7)",e.beginPath(),e.moveTo(s-t*.25,r),e.lineTo(s+t*.25,r),e.lineTo(s+t*.4,n),e.lineTo(s-t*.4,n),e.closePath(),e.fill(),e.fillStyle="rgba(184, 216, 224, 0.5)",e.beginPath(),e.moveTo(s,r),e.lineTo(s+t*.25,r),e.lineTo(s+t*.4,n),e.lineTo(s,n),e.closePath(),e.fill()}drawCharacter(e,t){e.save(),e.fillStyle="rgba(255, 255, 255, 0.9)",e.beginPath();const i=t.x+t.width/2,s=t.y,r=t.width/2;e.arc(i,s+r,r,Math.PI,0,!1),e.rect(t.x,s+r,t.width,t.height-r),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.9)",e.beginPath();const n=t.y+t.height,l=3,o=t.width/l;e.moveTo(t.x,n-5);for(let u=0;u<l;u++){const f=t.x+u*o;e.quadraticCurveTo(f+o/2,n+5,f+o,n-5)}e.lineTo(t.x+t.width,n-10),e.lineTo(t.x,n-10),e.closePath(),e.fill();const d=t.width*.08,c=t.y+t.height*.3,g=t.width*.25;e.fillStyle="#000000",e.beginPath(),e.arc(i-g,c,d,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(i+g,c,d,0,Math.PI*2),e.fill(),e.strokeStyle="rgba(200, 220, 255, 0.5)",e.lineWidth=2,e.beginPath(),e.arc(i,s+r,r+2,Math.PI,0,!1),e.stroke(),e.restore()}drawTrapdoor(e,t){if(!t.isActive)return;e.save(),e.fillStyle="#8B4513",e.fillRect(t.x,t.y,t.width,t.height),e.strokeStyle="#654321",e.lineWidth=2,e.beginPath(),e.moveTo(t.x+t.width/2,t.y),e.lineTo(t.x+t.width/2,t.y+t.height),e.stroke();for(let r=1;r<3;r++){e.beginPath();const n=t.y+t.height/3*r;e.moveTo(t.x,n),e.lineTo(t.x+t.width,n),e.stroke()}e.fillStyle="#FFD700";const i=t.x+t.width/2,s=t.y+t.height/2;e.beginPath(),e.arc(i,s,4,0,Math.PI*2),e.fill(),e.restore()}drawChalice(e,t){if(t.collected)return;e.save();const i=t.x+t.width/2,s=t.y,r=t.y+t.height;e.fillStyle="#FFD700",e.beginPath(),e.moveTo(i-t.width*.4,s),e.lineTo(i+t.width*.4,s),e.lineTo(i+t.width*.3,s+t.height*.6),e.lineTo(i-t.width*.3,s+t.height*.6),e.closePath(),e.fill(),e.fillRect(i-t.width*.1,s+t.height*.6,t.width*.2,t.height*.25),e.beginPath(),e.ellipse(i,r-t.height*.05,t.width*.35,t.height*.1,0,0,Math.PI*2),e.fill(),e.fillStyle="#FFED4E",e.beginPath(),e.ellipse(i-t.width*.15,s+t.height*.2,t.width*.1,t.height*.15,0,0,Math.PI*2),e.fill(),e.restore()}drawFireworks(e,t){e.save();for(const i of t){const s=i.life/i.maxLife;e.fillStyle=i.color,e.globalAlpha=s,e.beginPath(),e.arc(i.x,i.y,3,0,Math.PI*2),e.fill()}e.globalAlpha=1,e.restore()}drawWinScreen(e){e.save(),e.fillStyle="rgba(0, 0, 0, 0.5)",e.fillRect(0,0,this.canvasWidth,this.canvasHeight),e.fillStyle="#FFD700",e.font="bold 72px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("You Win!",this.canvasWidth/2,this.canvasHeight/2),e.strokeStyle="#FFF",e.lineWidth=3,e.strokeText("You Win!",this.canvasWidth/2,this.canvasHeight/2),e.restore()}drawLoseScreen(e){e.save(),e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,0,this.canvasWidth,this.canvasHeight),e.fillStyle="#FF4444",e.font="bold 72px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("Game Over",this.canvasWidth/2,this.canvasHeight/2),e.fillStyle="#FFF",e.font="24px Arial",e.fillText("You drowned!",this.canvasWidth/2,this.canvasHeight/2+60),e.restore()}}class F{constructor(e,t){h(this,"canvasWidth");h(this,"canvasHeight");h(this,"waterLevel");this.canvasWidth=e,this.canvasHeight=t,this.waterLevel=t*.1}getIcebergBounds(e){const t=e===1?0:this.waterLevel,i=e===1?this.waterLevel:this.canvasHeight;return{leftEdge:0,rightEdge:this.canvasWidth,topY:t,bottomY:i,getWidthAtY:s=>this.getWidthAtDepth(s,e)}}getWidthAtDepth(e,t){const i=this.canvasWidth/2;if(t===1){const r=.3+e/this.waterLevel*.2,n=this.canvasWidth*r/2;return{left:i-n,right:i+n}}else{const s=e-this.waterLevel,r=this.canvasHeight-this.waterLevel,l=.5+s/r*.3,o=this.canvasWidth*l/2;return{left:i-o,right:i+o}}}isWithinBounds(e,t,i,s,r){const n=this.getIcebergBounds(r);if(t<n.topY||t+s>n.bottomY)return!1;const l=t+s/2,{left:o,right:d}=n.getWidthAtY(l);return e>=o&&e+i<=d}generateTrapdoor(e){const t=this.getIcebergBounds(e),i=t.bottomY-30,{left:s,right:r}=t.getWidthAtY(i),n=100,l=s+n,o=r-n-80,d=l+Math.random()*(o-l);return new p(d,i)}generateChalice(e){if(e!==2)throw new Error("Chalice only appears on level 2");const t=this.getIcebergBounds(e),i=t.topY+100,s=t.bottomY-150,r=i+Math.random()*(s-i),{left:n,right:l}=t.getWidthAtY(r),o=80,d=n+o,c=l-o-40,g=d+Math.random()*(c-d);return new L(g,r)}getLevelData(e){const t=this.getIcebergBounds(e),i=t.bottomY-30;return{levelNumber:e,icebergBounds:t,trapdoorPosition:{x:0,y:i},chalicePosition:e===2?{x:0,y:0}:void 0,floorY:i}}}class S{checkBoundary(e,t){const i=e.getBounds();if(i.y<t.topY||i.y+i.height>t.bottomY)return!1;const s=i.y+i.height/2,{left:r,right:n}=t.getWidthAtY(s);return i.x>=r&&i.x+i.width<=n}checkTrapdoorOverlap(e,t){return t.checkOverlap(e)}checkChaliceCollision(e,t){return t.checkCollision(e)}}class P{constructor(e,t){h(this,"particles");h(this,"canvasWidth");h(this,"canvasHeight");h(this,"burstCount");h(this,"nextBurstTime");h(this,"elapsedTime");this.particles=[],this.canvasWidth=e,this.canvasHeight=t,this.burstCount=0,this.nextBurstTime=0,this.elapsedTime=0}initialize(){this.particles=[],this.burstCount=0,this.nextBurstTime=0,this.elapsedTime=0}createBurst(e,t,i=50){const s=["#FF0000","#FF7F00","#FFFF00","#00FF00","#0000FF","#4B0082","#9400D3"];for(let r=0;r<i;r++){const n=Math.PI*2*r/i,l=100+Math.random()*100;this.particles.push({x:e,y:t,vx:Math.cos(n)*l,vy:Math.sin(n)*l,color:s[Math.floor(Math.random()*s.length)],life:1,maxLife:1})}}update(e){if(this.elapsedTime+=e,this.burstCount<5&&this.elapsedTime>=this.nextBurstTime){const t=this.canvasWidth*(.2+Math.random()*.6),i=this.canvasHeight*(.2+Math.random()*.4);this.createBurst(t,i),this.burstCount++,this.nextBurstTime=this.elapsedTime+.5}for(let t=this.particles.length-1;t>=0;t--){const i=this.particles[t];i.x+=i.vx*e,i.y+=i.vy*e,i.vy+=200*e,i.life-=e*.8,i.life<=0&&this.particles.splice(t,1)}}getParticles(){return this.particles}isActive(){return this.particles.length>0||this.burstCount<5}}class k{constructor(e){h(this,"canvas");h(this,"context");h(this,"character");h(this,"inputHandler");h(this,"renderer");h(this,"levelManager");h(this,"collisionDetector");h(this,"fireworksSystem");h(this,"gameStatus");h(this,"isRunning");h(this,"currentLevel");h(this,"trapdoor");h(this,"chalice");h(this,"lastFrameTime");h(this,"animationFrameId");this.canvas=e;const t=e.getContext("2d");if(!t)throw new Error("Failed to get canvas 2D context");this.context=t,this.inputHandler=new b,this.renderer=new T(e.width,e.height),this.levelManager=new F(e.width,e.height),this.collisionDetector=new S,this.fireworksSystem=new P(e.width,e.height),this.gameStatus="playing",this.isRunning=!1,this.currentLevel=1,this.trapdoor=null,this.chalice=null,this.lastFrameTime=0,this.animationFrameId=null,this.character=new y(e.width/2-25,e.height*.05,50,60,200,e.width,1),this.initializeLevel(1)}initializeLevel(e){this.currentLevel=e,this.character.setLevel(e),e===1?(this.trapdoor=this.levelManager.generateTrapdoor(e),this.chalice=null,this.character.y=this.canvas.height*.05):e===2&&(this.trapdoor=null,this.chalice=this.levelManager.generateChalice(e),this.character.y=this.canvas.height*.12)}transitionToLevel(e){this.gameStatus="transitioning",setTimeout(()=>{this.initializeLevel(e),this.gameStatus="playing"},300)}triggerWin(){this.gameStatus="won",this.fireworksSystem.initialize()}triggerLose(){this.gameStatus="lost"}start(){this.isRunning||(this.isRunning=!0,this.inputHandler.initialize(),this.lastFrameTime=performance.now(),this.gameLoop(this.lastFrameTime))}stop(){this.isRunning=!1,this.inputHandler.cleanup(),this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}gameLoop(e){if(!this.isRunning)return;const t=(e-this.lastFrameTime)/1e3;this.lastFrameTime=e,this.update(t),this.render(),this.animationFrameId=requestAnimationFrame(i=>this.gameLoop(i))}update(e){if(this.inputHandler.update(),this.gameStatus==="playing"){const t=this.inputHandler.getActiveDirection();t&&this.character.move(t,e),this.checkCollisions()}else this.gameStatus==="won"&&this.fireworksSystem.update(e)}checkCollisions(){const e=this.levelManager.getIcebergBounds(this.currentLevel);if(!this.collisionDetector.checkBoundary(this.character,e)){this.triggerLose();return}this.trapdoor&&this.currentLevel===1&&this.collisionDetector.checkTrapdoorOverlap(this.character,this.trapdoor)&&this.inputHandler.isEnterPressed()&&(this.inputHandler.consumeEnter(),this.transitionToLevel(2)),this.chalice&&this.currentLevel===2&&this.collisionDetector.checkChaliceCollision(this.character,this.chalice)&&(this.chalice.collected=!0,this.triggerWin())}render(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.renderer.drawBackground(this.context,this.currentLevel),this.trapdoor&&this.currentLevel===1&&this.renderer.drawTrapdoor(this.context,this.trapdoor),this.chalice&&this.currentLevel===2&&this.renderer.drawChalice(this.context,this.chalice),this.renderer.drawCharacter(this.context,this.character),this.gameStatus==="won"?(this.renderer.drawFireworks(this.context,this.fireworksSystem.getParticles()),this.renderer.drawWinScreen(this.context)):this.gameStatus==="lost"&&this.renderer.drawLoseScreen(this.context)}getState(){return{status:this.gameStatus,isRunning:this.isRunning,currentLevel:this.currentLevel,character:this.character,trapdoor:this.trapdoor,chalice:this.chalice,canvas:this.canvas,context:this.context,lastFrameTime:this.lastFrameTime}}}function v(){const a=document.getElementById("gameCanvas");if(!a){console.error("Canvas element not found");return}try{const e=new k(a);e.start(),console.log("Tip of the Iceberg - Game started successfully!"),window.game=e}catch(e){console.error("Failed to initialize game:",e)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",v):v();
