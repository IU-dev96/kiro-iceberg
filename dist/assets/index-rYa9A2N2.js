var p=Object.defineProperty;var L=(o,t,i)=>t in o?p(o,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[t]=i;var h=(o,t,i)=>L(o,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&e(n)}).observe(document,{childList:!0,subtree:!0});function i(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(s){if(s.ep)return;s.ep=!0;const r=i(s);fetch(s.href,r)}})();class b{constructor(t,i,e,s,r,n,a=1){h(this,"x");h(this,"y");h(this,"width");h(this,"height");h(this,"velocity");h(this,"currentLevel");h(this,"facingDirection");h(this,"currentRotationY");h(this,"targetRotationY");h(this,"rotationAnimationProgress");h(this,"rotationAnimationDuration");h(this,"canvasWidth");this.x=t,this.y=i,this.width=e,this.height=s,this.velocity=r,this.canvasWidth=n,this.currentLevel=a,this.facingDirection="right",this.currentRotationY=0,this.targetRotationY=0,this.rotationAnimationProgress=1,this.rotationAnimationDuration=.15}move(t,i){this.facingDirection=t;const e=t==="left"?Math.PI:0;this.targetRotationY!==e&&(this.targetRotationY=e,this.rotationAnimationProgress=0);const s=this.velocity*i;t==="left"?this.x=Math.max(0,this.x-s):t==="right"&&(this.x=Math.min(this.canvasWidth-this.width,this.x+s))}setLevel(t){this.currentLevel=t}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}draw(t){t.fillStyle="rgba(255, 255, 255, 0.8)",t.fillRect(this.x,this.y,this.width,this.height)}updateCanvasWidth(t){this.canvasWidth=t,this.x=Math.min(this.x,this.canvasWidth-this.width)}getFacingDirection(){return this.facingDirection}getRotationY(){return this.currentRotationY}update(t){if(this.rotationAnimationProgress<1){const i=this.currentRotationY;this.rotationAnimationProgress+=t/this.rotationAnimationDuration,this.rotationAnimationProgress=Math.min(1,this.rotationAnimationProgress);const e=this.rotationAnimationProgress,s=1-Math.pow(1-e,3);this.currentRotationY=i+(this.targetRotationY-i)*s}}}class F{constructor(t,i,e=80,s=20){h(this,"x");h(this,"y");h(this,"width");h(this,"height");h(this,"isActive");this.x=t,this.y=i,this.width=e,this.height=s,this.isActive=!0}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}checkOverlap(t){const i=t.getBounds(),e=this.getBounds(),s=i.x+i.width/2,r=i.y+i.height;return this.isActive&&s>=e.x&&s<=e.x+e.width&&r>=e.y&&r<=e.y+e.height}}class P{constructor(t,i,e=40,s=50){h(this,"x");h(this,"y");h(this,"width");h(this,"height");h(this,"collected");this.x=t,this.y=i,this.width=e,this.height=s,this.collected=!1}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}checkCollision(t){if(this.collected)return!1;const i=t.getBounds(),e=this.getBounds();return i.x<e.x+e.width&&i.x+i.width>e.x&&i.y<e.y+e.height&&i.y+i.height>e.y}}class T{constructor(){h(this,"keys");h(this,"activeDirection");h(this,"enterPressed");h(this,"keydownHandler");h(this,"keyupHandler");this.keys=new Map,this.activeDirection=null,this.enterPressed=!1,this.keydownHandler=this.handleKeyDown.bind(this),this.keyupHandler=this.handleKeyUp.bind(this)}initialize(){window.addEventListener("keydown",this.keydownHandler),window.addEventListener("keyup",this.keyupHandler)}cleanup(){window.removeEventListener("keydown",this.keydownHandler),window.removeEventListener("keyup",this.keyupHandler)}handleKeyDown(t){const i=t.key;(i==="ArrowLeft"||i==="ArrowRight")&&(t.preventDefault(),this.keys.get(i)||(this.keys.set(i,!0),i==="ArrowLeft"?this.activeDirection="left":i==="ArrowRight"&&(this.activeDirection="right"))),i==="Enter"&&(t.preventDefault(),this.enterPressed=!0)}handleKeyUp(t){const i=t.key;(i==="ArrowLeft"||i==="ArrowRight")&&(t.preventDefault(),this.keys.set(i,!1),i==="ArrowLeft"&&this.activeDirection==="left"?this.keys.get("ArrowRight")?this.activeDirection="right":this.activeDirection=null:i==="ArrowRight"&&this.activeDirection==="right"&&(this.keys.get("ArrowLeft")?this.activeDirection="left":this.activeDirection=null)),i==="Enter"&&(t.preventDefault(),this.enterPressed=!1)}isKeyPressed(t){return this.keys.get(t)||!1}getActiveDirection(){return this.activeDirection}isEnterPressed(){return this.enterPressed}consumeEnter(){this.enterPressed=!1}update(){}}class S{constructor(t,i){h(this,"canvasWidth");h(this,"canvasHeight");h(this,"waterLevel");h(this,"ghostImage");h(this,"imageLoaded");this.canvasWidth=t,this.canvasHeight=i,this.waterLevel=i*.1,this.ghostImage=null,this.imageLoaded=!1,this.loadGhostImage()}loadGhostImage(){this.ghostImage=new Image,this.ghostImage.onload=()=>{this.imageLoaded=!0},this.ghostImage.onerror=()=>{console.warn("Failed to load ghost image, will use fallback rendering"),this.imageLoaded=!1},this.ghostImage.src="https://kiro.dev/icon.svg?fe599162bb293ea0"}drawBackground(t,i){const e=this.canvasWidth,s=this.canvasHeight;if(i===1){const r=t.createLinearGradient(0,0,0,this.waterLevel);r.addColorStop(0,"#87CEEB"),r.addColorStop(1,"#B0E0E6"),t.fillStyle=r,t.fillRect(0,0,e,this.waterLevel),this.drawIcebergLevel1(t,e)}else{const r=t.createLinearGradient(0,this.waterLevel,0,s);r.addColorStop(0,"#4682B4"),r.addColorStop(.5,"#1E3A5F"),r.addColorStop(1,"#0F1F3F"),t.fillStyle=r,t.fillRect(0,0,e,s),this.drawIcebergLevel2(t,e,s)}}drawIcebergLevel1(t,i){const e=i/2,s=0,r=this.waterLevel;t.fillStyle="#E0F2F7",t.beginPath(),t.moveTo(e-i*.15,s),t.lineTo(e+i*.15,s),t.lineTo(e+i*.25,r),t.lineTo(e-i*.25,r),t.closePath(),t.fill(),t.fillStyle="#B8D8E0",t.beginPath(),t.moveTo(e,s),t.lineTo(e+i*.15,s),t.lineTo(e+i*.25,r),t.lineTo(e,r),t.closePath(),t.fill()}drawIcebergLevel2(t,i,e){const s=i/2,r=this.waterLevel,n=e;t.fillStyle="rgba(224, 242, 247, 0.7)",t.beginPath(),t.moveTo(s-i*.25,r),t.lineTo(s+i*.25,r),t.lineTo(s+i*.4,n),t.lineTo(s-i*.4,n),t.closePath(),t.fill(),t.fillStyle="rgba(184, 216, 224, 0.5)",t.beginPath(),t.moveTo(s,r),t.lineTo(s+i*.25,r),t.lineTo(s+i*.4,n),t.lineTo(s,n),t.closePath(),t.fill()}drawCharacter(t,i){t.save();const e=i.getRotationY(),s=i.x+i.width/2,r=i.y+i.height/2;if(t.translate(s,r),t.scale(Math.cos(e),1),t.translate(-s,-r),this.imageLoaded&&this.ghostImage)t.drawImage(this.ghostImage,i.x,i.y,i.width,i.height);else{t.fillStyle="rgba(255, 255, 255, 0.9)",t.beginPath();const n=i.x+i.width/2,a=i.y,l=i.width/2;t.arc(n,a+l,l,Math.PI,0,!1),t.rect(i.x,a+l,i.width,i.height-l),t.fill(),t.fillStyle="rgba(255, 255, 255, 0.9)",t.beginPath();const d=i.y+i.height,c=3,g=i.width/c;t.moveTo(i.x,d-5);for(let u=0;u<c;u++){const v=i.x+u*g;t.quadraticCurveTo(v+g/2,d+5,v+g,d-5)}t.lineTo(i.x+i.width,d-10),t.lineTo(i.x,d-10),t.closePath(),t.fill();const f=i.width*.08,m=i.y+i.height*.3,w=i.width*.25;t.fillStyle="#000000",t.beginPath(),t.arc(n-w,m,f,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(n+w,m,f,0,Math.PI*2),t.fill(),t.strokeStyle="rgba(200, 220, 255, 0.5)",t.lineWidth=2,t.beginPath(),t.arc(n,a+l,l+2,Math.PI,0,!1),t.stroke()}t.restore()}drawTrapdoor(t,i){if(!i.isActive)return;t.save(),t.fillStyle="#8B4513",t.fillRect(i.x,i.y,i.width,i.height),t.strokeStyle="#654321",t.lineWidth=2,t.beginPath(),t.moveTo(i.x+i.width/2,i.y),t.lineTo(i.x+i.width/2,i.y+i.height),t.stroke();for(let r=1;r<3;r++){t.beginPath();const n=i.y+i.height/3*r;t.moveTo(i.x,n),t.lineTo(i.x+i.width,n),t.stroke()}t.fillStyle="#FFD700";const e=i.x+i.width/2,s=i.y+i.height/2;t.beginPath(),t.arc(e,s,4,0,Math.PI*2),t.fill(),t.restore()}drawChalice(t,i){if(i.collected)return;t.save();const e=i.x+i.width/2,s=i.y,r=i.y+i.height;t.fillStyle="#FFD700",t.beginPath(),t.moveTo(e-i.width*.4,s),t.lineTo(e+i.width*.4,s),t.lineTo(e+i.width*.3,s+i.height*.6),t.lineTo(e-i.width*.3,s+i.height*.6),t.closePath(),t.fill(),t.fillRect(e-i.width*.1,s+i.height*.6,i.width*.2,i.height*.25),t.beginPath(),t.ellipse(e,r-i.height*.05,i.width*.35,i.height*.1,0,0,Math.PI*2),t.fill(),t.fillStyle="#FFED4E",t.beginPath(),t.ellipse(e-i.width*.15,s+i.height*.2,i.width*.1,i.height*.15,0,0,Math.PI*2),t.fill(),t.restore()}drawFireworks(t,i){t.save();for(const e of i){const s=e.life/e.maxLife;t.fillStyle=e.color,t.globalAlpha=s,t.beginPath(),t.arc(e.x,e.y,3,0,Math.PI*2),t.fill()}t.globalAlpha=1,t.restore()}drawWinScreen(t){t.save(),t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(0,0,this.canvasWidth,this.canvasHeight),t.fillStyle="#FFD700",t.font="bold 72px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("You Win!",this.canvasWidth/2,this.canvasHeight/2),t.strokeStyle="#FFF",t.lineWidth=3,t.strokeText("You Win!",this.canvasWidth/2,this.canvasHeight/2),t.restore()}drawLoseScreen(t){t.save(),t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(0,0,this.canvasWidth,this.canvasHeight),t.fillStyle="#FF4444",t.font="bold 72px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("Game Over",this.canvasWidth/2,this.canvasHeight/2),t.fillStyle="#FFF",t.font="24px Arial",t.fillText("You drowned!",this.canvasWidth/2,this.canvasHeight/2+60),t.restore()}}class k{constructor(t,i){h(this,"canvasWidth");h(this,"canvasHeight");h(this,"waterLevel");this.canvasWidth=t,this.canvasHeight=i,this.waterLevel=i*.1}getIcebergBounds(t){const i=t===1?0:this.waterLevel,e=t===1?this.waterLevel:this.canvasHeight;return{leftEdge:0,rightEdge:this.canvasWidth,topY:i,bottomY:e,getWidthAtY:s=>this.getWidthAtDepth(s,t)}}getWidthAtDepth(t,i){const e=this.canvasWidth/2;if(i===1){const r=.3+t/this.waterLevel*.2,n=this.canvasWidth*r/2;return{left:e-n,right:e+n}}else{const s=t-this.waterLevel,r=this.canvasHeight-this.waterLevel,a=.5+s/r*.3,l=this.canvasWidth*a/2;return{left:e-l,right:e+l}}}isWithinBounds(t,i,e,s,r){const n=this.getIcebergBounds(r);if(i<n.topY||i+s>n.bottomY)return!1;const a=i+s/2,{left:l,right:d}=n.getWidthAtY(a);return t>=l&&t+e<=d}generateTrapdoor(t){const i=this.getIcebergBounds(t),e=i.bottomY-30,{left:s,right:r}=i.getWidthAtY(e),n=100,a=s+n,l=r-n-80,d=a+Math.random()*(l-a);return new F(d,e)}generateChalice(t){if(t!==2)throw new Error("Chalice only appears on level 2");const i=this.getIcebergBounds(t),e=i.topY+100,s=i.bottomY-150,r=e+Math.random()*(s-e),{left:n,right:a}=i.getWidthAtY(r),l=80,d=n+l,c=a-l-40,g=d+Math.random()*(c-d);return new P(g,r)}getLevelData(t){const i=this.getIcebergBounds(t),e=i.bottomY-30;return{levelNumber:t,icebergBounds:i,trapdoorPosition:{x:0,y:e},chalicePosition:t===2?{x:0,y:0}:void 0,floorY:e}}}class Y{checkBoundary(t,i){const e=t.getBounds(),s=5;if(e.y<i.topY-s||e.y+e.height>i.bottomY+s)return!1;const r=e.y+e.height/2,{left:n,right:a}=i.getWidthAtY(r);return e.x>=n-s&&e.x+e.width<=a+s}checkTrapdoorOverlap(t,i){return i.checkOverlap(t)}checkChaliceCollision(t,i){return i.checkCollision(t)}}class A{constructor(t,i){h(this,"particles");h(this,"canvasWidth");h(this,"canvasHeight");h(this,"burstCount");h(this,"nextBurstTime");h(this,"elapsedTime");this.particles=[],this.canvasWidth=t,this.canvasHeight=i,this.burstCount=0,this.nextBurstTime=0,this.elapsedTime=0}initialize(){this.particles=[],this.burstCount=0,this.nextBurstTime=0,this.elapsedTime=0}createBurst(t,i,e=50){const s=["#FF0000","#FF7F00","#FFFF00","#00FF00","#0000FF","#4B0082","#9400D3"];for(let r=0;r<e;r++){const n=Math.PI*2*r/e,a=100+Math.random()*100;this.particles.push({x:t,y:i,vx:Math.cos(n)*a,vy:Math.sin(n)*a,color:s[Math.floor(Math.random()*s.length)],life:1,maxLife:1})}}update(t){if(this.elapsedTime+=t,this.burstCount<5&&this.elapsedTime>=this.nextBurstTime){const i=this.canvasWidth*(.2+Math.random()*.6),e=this.canvasHeight*(.2+Math.random()*.4);this.createBurst(i,e),this.burstCount++,this.nextBurstTime=this.elapsedTime+.5}for(let i=this.particles.length-1;i>=0;i--){const e=this.particles[i];e.x+=e.vx*t,e.y+=e.vy*t,e.vy+=200*t,e.life-=t*.8,e.life<=0&&this.particles.splice(i,1)}}getParticles(){return this.particles}isActive(){return this.particles.length>0||this.burstCount<5}}class W{constructor(t){h(this,"canvas");h(this,"context");h(this,"character");h(this,"inputHandler");h(this,"renderer");h(this,"levelManager");h(this,"collisionDetector");h(this,"fireworksSystem");h(this,"gameStatus");h(this,"isRunning");h(this,"currentLevel");h(this,"trapdoor");h(this,"chalice");h(this,"lastFrameTime");h(this,"animationFrameId");this.canvas=t;const i=t.getContext("2d");if(!i)throw new Error("Failed to get canvas 2D context");this.context=i,this.inputHandler=new T,this.renderer=new S(t.width,t.height),this.levelManager=new k(t.width,t.height),this.collisionDetector=new Y,this.fireworksSystem=new A(t.width,t.height),this.gameStatus="playing",this.isRunning=!1,this.currentLevel=1,this.trapdoor=null,this.chalice=null,this.lastFrameTime=0,this.animationFrameId=null;const e=t.height*.1,s=Math.min(40,e*.6),r=35;this.character=new b(t.width/2-r/2,e*.2,r,s,200,t.width,1),this.initializeLevel(1)}initializeLevel(t){if(this.currentLevel=t,this.character.setLevel(t),t===1){this.trapdoor=this.levelManager.generateTrapdoor(t),this.chalice=null;const i=this.canvas.height*.1;this.character.x=this.canvas.width/2-this.character.width/2,this.character.y=i*.2}else if(t===2){this.trapdoor=null,this.chalice=this.levelManager.generateChalice(t);const i=this.canvas.height*.1;this.character.x=this.canvas.width/2-this.character.width/2,this.character.y=i+10}}transitionToLevel(t){this.gameStatus="transitioning",setTimeout(()=>{this.initializeLevel(t),this.gameStatus="playing"},300)}triggerWin(){this.gameStatus="won",this.fireworksSystem.initialize()}triggerLose(){this.gameStatus="lost"}start(){this.isRunning||(this.isRunning=!0,this.inputHandler.initialize(),this.lastFrameTime=performance.now(),this.gameLoop(this.lastFrameTime))}stop(){this.isRunning=!1,this.inputHandler.cleanup(),this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}gameLoop(t){if(!this.isRunning)return;const i=(t-this.lastFrameTime)/1e3;this.lastFrameTime=t,this.update(i),this.render(),this.animationFrameId=requestAnimationFrame(e=>this.gameLoop(e))}update(t){if(this.inputHandler.update(),this.character.update(t),this.gameStatus==="playing"){const i=this.inputHandler.getActiveDirection();i&&this.character.move(i,t),this.checkCollisions()}else this.gameStatus==="won"&&this.fireworksSystem.update(t)}checkCollisions(){const t=this.levelManager.getIcebergBounds(this.currentLevel);if(!this.collisionDetector.checkBoundary(this.character,t)){this.triggerLose();return}this.trapdoor&&this.currentLevel===1&&this.collisionDetector.checkTrapdoorOverlap(this.character,this.trapdoor)&&this.inputHandler.isEnterPressed()&&(this.inputHandler.consumeEnter(),this.transitionToLevel(2)),this.chalice&&this.currentLevel===2&&this.collisionDetector.checkChaliceCollision(this.character,this.chalice)&&(this.chalice.collected=!0,this.triggerWin())}render(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.renderer.drawBackground(this.context,this.currentLevel),this.trapdoor&&this.currentLevel===1&&this.renderer.drawTrapdoor(this.context,this.trapdoor),this.chalice&&this.currentLevel===2&&this.renderer.drawChalice(this.context,this.chalice),this.renderer.drawCharacter(this.context,this.character),this.gameStatus==="won"?(this.renderer.drawFireworks(this.context,this.fireworksSystem.getParticles()),this.renderer.drawWinScreen(this.context)):this.gameStatus==="lost"&&this.renderer.drawLoseScreen(this.context)}getState(){return{status:this.gameStatus,isRunning:this.isRunning,currentLevel:this.currentLevel,character:this.character,trapdoor:this.trapdoor,chalice:this.chalice,canvas:this.canvas,context:this.context,lastFrameTime:this.lastFrameTime}}}function y(){const o=document.getElementById("gameCanvas");if(!o){console.error("Canvas element not found");return}try{const t=new W(o);t.start(),console.log("Tip of the Iceberg - Game started successfully!"),window.game=t}catch(t){console.error("Failed to initialize game:",t)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",y):y();
