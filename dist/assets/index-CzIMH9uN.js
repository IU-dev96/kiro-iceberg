var L=Object.defineProperty;var Y=(o,i,t)=>i in o?L(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t;var a=(o,i,t)=>Y(o,typeof i!="symbol"?i+"":i,t);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const h of s)if(h.type==="childList")for(const r of h.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const h={};return s.integrity&&(h.integrity=s.integrity),s.referrerPolicy&&(h.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?h.credentials="include":s.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function e(s){if(s.ep)return;s.ep=!0;const h=t(s);fetch(s.href,h)}})();class W{constructor(i,t,e,s,h,r,n=1){a(this,"x");a(this,"y");a(this,"width");a(this,"height");a(this,"velocity");a(this,"currentLevel");a(this,"canvasWidth");a(this,"velocityY");a(this,"isJumping");a(this,"isOnGround");a(this,"jumpStrength");a(this,"gravity");a(this,"facingDirection");a(this,"currentRotationY");a(this,"targetRotationY");a(this,"rotationAnimationProgress");a(this,"rotationAnimationDuration");this.x=i,this.y=t,this.width=e,this.height=s,this.velocity=h,this.canvasWidth=r,this.currentLevel=n,this.velocityY=0,this.isJumping=!1,this.isOnGround=!0,this.jumpStrength=-400,this.gravity=800,this.facingDirection="right",this.currentRotationY=0,this.targetRotationY=0,this.rotationAnimationProgress=1,this.rotationAnimationDuration=.15}move(i,t){this.facingDirection=i;const e=i==="left"?Math.PI:0;this.targetRotationY!==e&&(this.targetRotationY=e,this.rotationAnimationProgress=0);const s=this.velocity*t;i==="left"?this.x=this.x-s:i==="right"&&(this.x=this.x+s)}setLevel(i){this.currentLevel=i}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}draw(i){i.fillStyle="rgba(255, 255, 255, 0.8)",i.fillRect(this.x,this.y,this.width,this.height)}updateCanvasWidth(i){this.canvasWidth=i,this.x=Math.min(this.x,this.canvasWidth-this.width)}jump(){this.isOnGround&&!this.isJumping&&(this.velocityY=this.jumpStrength,this.isJumping=!0,this.isOnGround=!1)}applyGravity(i){if(this.isJumping){this.velocityY+=this.gravity*i;const t=600;this.velocityY=Math.min(this.velocityY,t)}}land(){this.velocityY=0,this.isJumping=!1,this.isOnGround=!0}updatePhysics(i){this.applyGravity(i),this.y+=this.velocityY*i,this.updateRotation(i)}getRotationY(){return this.currentRotationY}updateRotationOnly(i){this.updateRotation(i)}updateRotation(i){if(this.rotationAnimationProgress<1){const t=this.currentRotationY;this.rotationAnimationProgress+=i/this.rotationAnimationDuration,this.rotationAnimationProgress=Math.min(1,this.rotationAnimationProgress);const e=this.rotationAnimationProgress,s=1-Math.pow(1-e,3);this.currentRotationY=t+(this.targetRotationY-t)*s}}}class C{constructor(i,t,e){a(this,"x");a(this,"y");a(this,"width");a(this,"height");a(this,"velocityX");a(this,"type");a(this,"direction");i<=2?(this.type="small-fish",this.width=20+i*5,this.height=15+i*3):i<=4?(this.type="large-fish",this.width=35+(i-2)*7,this.height=25+(i-2)*5):(this.type="shark",this.width=60+(i-4)*15,this.height=40+(i-4)*10),this.direction=Math.random()>.5?"left":"right",this.direction==="right"?this.x=-this.width:this.x=t,this.y=Math.random()*(e-this.height);const s=50+i*10;this.velocityX=this.direction==="right"?s:-s}update(i,t){this.x+=this.velocityX*i,this.direction==="right"&&this.x>t?this.x=-this.width:this.direction==="left"&&this.x+this.width<0&&(this.x=t)}draw(i){if(i.save(),this.type==="small-fish"?i.fillStyle="#4A90E2":this.type==="large-fish"?i.fillStyle="#2E5C8A":i.fillStyle="#1A3A52",i.beginPath(),this.type==="shark"){const t=this.y+this.height/2;i.moveTo(this.x,t),i.lineTo(this.x+this.width*.7,t-this.height*.3),i.lineTo(this.x+this.width,t),i.lineTo(this.x+this.width*.7,t+this.height*.3),i.closePath()}else i.ellipse(this.x+this.width/2,this.y+this.height/2,this.width/2,this.height/2,0,0,Math.PI*2);i.fill(),i.beginPath(),this.direction==="right"?(i.moveTo(this.x,this.y+this.height/2),i.lineTo(this.x-this.width*.3,this.y),i.lineTo(this.x-this.width*.3,this.y+this.height)):(i.moveTo(this.x+this.width,this.y+this.height/2),i.lineTo(this.x+this.width*1.3,this.y),i.lineTo(this.x+this.width*1.3,this.y+this.height)),i.closePath(),i.fill(),i.restore()}}class k{constructor(i,t,e=60,s=80){a(this,"x");a(this,"y");a(this,"width");a(this,"height");a(this,"isActive");this.x=i,this.y=t,this.width=e,this.height=s,this.isActive=!0}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}checkOverlap(i){const t=i.getBounds(),e=this.getBounds();return this.isActive&&t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}}class P{constructor(i,t,e=80,s=20){a(this,"x");a(this,"y");a(this,"width");a(this,"height");a(this,"isActive");this.x=i,this.y=t,this.width=e,this.height=s,this.isActive=!0}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}checkOverlap(i){const t=i.getBounds(),e=this.getBounds(),s=t.x+t.width/2,h=t.y+t.height;return this.isActive&&s>=e.x&&s<=e.x+e.width&&h>=e.y&&h<=e.y+e.height}}class M{constructor(i,t,e,s,h="block"){a(this,"x");a(this,"y");a(this,"width");a(this,"height");a(this,"type");this.x=i,this.y=t,this.width=e,this.height=s,this.type=h}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}checkCollision(i){const t=i.getBounds(),e=this.getBounds();if(!(t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y))return{collided:!1,side:null};const h=t.x+t.width-e.x,r=e.x+e.width-t.x,n=t.y+t.height-e.y,l=e.y+e.height-t.y,c=Math.min(h,r,n,l);let d;return c===h?d="left":c===r?d="right":c===n?d="top":d="bottom",{collided:!0,side:d}}}class B{constructor(i,t,e=40,s=50){a(this,"x");a(this,"y");a(this,"width");a(this,"height");a(this,"collected");this.x=i,this.y=t,this.width=e,this.height=s,this.collected=!1}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}checkCollision(i){if(this.collected)return!1;const t=i.getBounds(),e=this.getBounds();return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}}class D{constructor(){a(this,"keys");a(this,"activeDirection");a(this,"enterPressed");a(this,"spacePressed");a(this,"keydownHandler");a(this,"keyupHandler");this.keys=new Map,this.activeDirection=null,this.enterPressed=!1,this.spacePressed=!1,this.keydownHandler=this.handleKeyDown.bind(this),this.keyupHandler=this.handleKeyUp.bind(this)}initialize(){window.addEventListener("keydown",this.keydownHandler),window.addEventListener("keyup",this.keyupHandler)}cleanup(){window.removeEventListener("keydown",this.keydownHandler),window.removeEventListener("keyup",this.keyupHandler)}handleKeyDown(i){const t=i.key;(t==="ArrowLeft"||t==="ArrowRight")&&(i.preventDefault(),this.keys.get(t)||(this.keys.set(t,!0),t==="ArrowLeft"?this.activeDirection="left":t==="ArrowRight"&&(this.activeDirection="right"))),t==="Enter"&&(i.preventDefault(),this.enterPressed=!0),(t===" "||t==="Spacebar")&&(i.preventDefault(),this.spacePressed=!0)}handleKeyUp(i){const t=i.key;(t==="ArrowLeft"||t==="ArrowRight")&&(i.preventDefault(),this.keys.set(t,!1),t==="ArrowLeft"&&this.activeDirection==="left"?this.keys.get("ArrowRight")?this.activeDirection="right":this.activeDirection=null:t==="ArrowRight"&&this.activeDirection==="right"&&(this.keys.get("ArrowLeft")?this.activeDirection="left":this.activeDirection=null)),t==="Enter"&&(i.preventDefault(),this.enterPressed=!1),(t===" "||t==="Spacebar")&&(i.preventDefault(),this.spacePressed=!1)}isKeyPressed(i){return this.keys.get(i)||!1}getActiveDirection(){return this.activeDirection}isEnterPressed(){return this.enterPressed}consumeEnter(){this.enterPressed=!1}isSpacePressed(){return this.spacePressed}consumeSpace(){this.spacePressed=!1}update(){}}class I{constructor(i,t){a(this,"canvasWidth");a(this,"canvasHeight");a(this,"waterLevel");a(this,"ghostImage");a(this,"imageLoaded");this.canvasWidth=i,this.canvasHeight=t,this.waterLevel=t*.1,this.ghostImage=null,this.imageLoaded=!1,this.loadGhostImage()}loadGhostImage(){this.ghostImage=new Image,this.ghostImage.onload=()=>{this.imageLoaded=!0},this.ghostImage.onerror=()=>{console.warn("Failed to load ghost image, will use fallback rendering"),this.imageLoaded=!1},this.ghostImage.src="https://kiro.dev/icon.svg?fe599162bb293ea0"}drawBackground(i,t){const e=this.canvasWidth,s=this.canvasHeight,h=i.createLinearGradient(0,0,0,s);h.addColorStop(0,"#4682B4"),h.addColorStop(.5,"#1E3A5F"),h.addColorStop(1,"#0F1F3F"),i.fillStyle=h,i.fillRect(0,0,e*4,s),this.drawIcebergLevel2(i,e,s)}drawStartingArea(i){const t=this.canvasWidth,e=this.canvasHeight,s=i.createLinearGradient(0,0,0,this.waterLevel);s.addColorStop(0,"#87CEEB"),s.addColorStop(1,"#B0E0E6"),i.fillStyle=s,i.fillRect(0,0,t,this.waterLevel);const h=i.createLinearGradient(0,this.waterLevel,0,e);h.addColorStop(0,"#4682B4"),h.addColorStop(.5,"#1E3A5F"),h.addColorStop(1,"#0F1F3F"),i.fillStyle=h,i.fillRect(0,this.waterLevel,t,e-this.waterLevel),this.drawIcebergLevel1(i,t),this.drawIcebergLevel2Original(i,t,e)}drawIcebergLevel1(i,t){const e=t/2,s=0,h=this.waterLevel;i.fillStyle="#E0F2F7",i.beginPath(),i.moveTo(e-t*.15,s),i.lineTo(e+t*.15,s),i.lineTo(e+t*.25,h),i.lineTo(e-t*.25,h),i.closePath(),i.fill(),i.fillStyle="#B8D8E0",i.beginPath(),i.moveTo(e,s),i.lineTo(e+t*.15,s),i.lineTo(e+t*.25,h),i.lineTo(e,h),i.closePath(),i.fill()}drawIcebergLevel2(i,t,e){const s=this.waterLevel,h=e,r=1200;i.fillStyle="rgba(224, 242, 247, 0.7)",i.beginPath(),i.moveTo(200,s),i.lineTo(1e3,s),i.lineTo(r,h),i.lineTo(0,h),i.closePath(),i.fill(),i.fillStyle="rgba(184, 216, 224, 0.5)",i.beginPath(),i.moveTo(600,s),i.lineTo(1e3,s),i.lineTo(r,h),i.lineTo(600,h),i.closePath(),i.fill()}drawIcebergLevel2Original(i,t,e){const s=t/2,h=this.waterLevel,r=e;i.fillStyle="rgba(224, 242, 247, 0.7)",i.beginPath(),i.moveTo(s-t*.25,h),i.lineTo(s+t*.25,h),i.lineTo(s+t*.4,r),i.lineTo(s-t*.4,r),i.closePath(),i.fill(),i.fillStyle="rgba(184, 216, 224, 0.5)",i.beginPath(),i.moveTo(s,h),i.lineTo(s+t*.25,h),i.lineTo(s+t*.4,r),i.lineTo(s,r),i.closePath(),i.fill()}drawCharacter(i,t){i.save();const e=t.getRotationY(),s=t.x+t.width/2,h=t.y+t.height/2;if(i.translate(s,h),i.scale(Math.cos(e),1),i.translate(-s,-h),this.imageLoaded&&this.ghostImage)i.drawImage(this.ghostImage,t.x,t.y,t.width,t.height);else{i.fillStyle="rgba(255, 255, 255, 0.9)",i.beginPath();const r=t.y,n=t.width/2;i.arc(s,r+n,n,Math.PI,0,!1),i.rect(t.x,r+n,t.width,t.height-n),i.fill(),i.fillStyle="rgba(255, 255, 255, 0.9)",i.beginPath();const l=t.y+t.height,c=3,d=t.width/c;i.moveTo(t.x,l-5);for(let f=0;f<c;f++){const m=t.x+f*d;i.quadraticCurveTo(m+d/2,l+5,m+d,l-5)}i.lineTo(t.x+t.width,l-10),i.lineTo(t.x,l-10),i.closePath(),i.fill();const u=t.width*.08,y=t.y+t.height*.3,p=t.width*.25;i.fillStyle="#000000",i.beginPath(),i.arc(s-p,y,u,0,Math.PI*2),i.fill(),i.beginPath(),i.arc(s+p,y,u,0,Math.PI*2),i.fill(),i.strokeStyle="rgba(200, 220, 255, 0.5)",i.lineWidth=2,i.beginPath(),i.arc(s,r+n,n+2,Math.PI,0,!1),i.stroke()}i.restore()}drawTrapdoor(i,t){if(!t.isActive)return;i.save(),i.fillStyle="#8B4513",i.fillRect(t.x,t.y,t.width,t.height),i.strokeStyle="#654321",i.lineWidth=2,i.beginPath(),i.moveTo(t.x+t.width/2,t.y),i.lineTo(t.x+t.width/2,t.y+t.height),i.stroke();for(let h=1;h<3;h++){i.beginPath();const r=t.y+t.height/3*h;i.moveTo(t.x,r),i.lineTo(t.x+t.width,r),i.stroke()}i.fillStyle="#FFD700";const e=t.x+t.width/2,s=t.y+t.height/2;i.beginPath(),i.arc(e,s,4,0,Math.PI*2),i.fill(),i.restore()}drawChalice(i,t){if(t.collected)return;i.save();const e=t.x+t.width/2,s=t.y,h=t.y+t.height;i.fillStyle="#FFD700",i.beginPath(),i.moveTo(e-t.width*.4,s),i.lineTo(e+t.width*.4,s),i.lineTo(e+t.width*.3,s+t.height*.6),i.lineTo(e-t.width*.3,s+t.height*.6),i.closePath(),i.fill(),i.fillRect(e-t.width*.1,s+t.height*.6,t.width*.2,t.height*.25),i.beginPath(),i.ellipse(e,h-t.height*.05,t.width*.35,t.height*.1,0,0,Math.PI*2),i.fill(),i.fillStyle="#FFED4E",i.beginPath(),i.ellipse(e-t.width*.15,s+t.height*.2,t.width*.1,t.height*.15,0,0,Math.PI*2),i.fill(),i.restore()}drawFireworks(i,t){i.save();for(const e of t){const s=e.life/e.maxLife;i.fillStyle=e.color,i.globalAlpha=s,i.beginPath(),i.arc(e.x,e.y,3,0,Math.PI*2),i.fill()}i.globalAlpha=1,i.restore()}drawWinScreen(i){i.save(),i.fillStyle="rgba(0, 0, 0, 0.5)",i.fillRect(0,0,this.canvasWidth,this.canvasHeight),i.fillStyle="#FFD700",i.font="bold 72px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("You Win!",this.canvasWidth/2,this.canvasHeight/2),i.strokeStyle="#FFF",i.lineWidth=3,i.strokeText("You Win!",this.canvasWidth/2,this.canvasHeight/2),i.restore()}drawLoseScreen(i){i.save(),i.fillStyle="rgba(0, 0, 0, 0.7)",i.fillRect(0,0,this.canvasWidth,this.canvasHeight),i.fillStyle="#FF4444",i.font="bold 72px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("Game Over",this.canvasWidth/2,this.canvasHeight/2),i.fillStyle="#FFF",i.font="24px Arial",i.fillText("You drowned!",this.canvasWidth/2,this.canvasHeight/2+60),i.restore()}drawObstacle(i,t){i.save(),i.fillStyle="#8B7355",i.fillRect(t.x,t.y,t.width,t.height),i.strokeStyle="#654321",i.lineWidth=2,i.strokeRect(t.x,t.y,t.width,t.height),i.strokeStyle="#A0826D",i.lineWidth=1;for(let e=1;e<3;e++){const s=t.y+t.height/3*e;i.beginPath(),i.moveTo(t.x,s),i.lineTo(t.x+t.width,s),i.stroke()}i.restore()}drawDoor(i,t,e=!1){t.isActive&&(i.save(),i.fillStyle="#8B4513",i.fillRect(t.x,t.y,t.width,t.height),i.strokeStyle="#654321",i.lineWidth=3,i.beginPath(),i.moveTo(t.x+t.width/2,t.y+5),i.lineTo(t.x+t.width/2,t.y+t.height-5),i.stroke(),i.beginPath(),i.moveTo(t.x+5,t.y+t.height/2),i.lineTo(t.x+t.width-5,t.y+t.height/2),i.stroke(),i.fillStyle="#FFD700",i.beginPath(),i.arc(t.x+t.width*.7,t.y+t.height/2,5,0,Math.PI*2),i.fill(),e&&(i.fillStyle="rgba(255, 255, 255, 0.9)",i.font="14px Arial",i.textAlign="center",i.fillText("Press ENTER",t.x+t.width/2,t.y-10)),i.restore())}drawSeaCreatures(i,t){for(const e of t)e.draw(i)}drawLevelBanner(i,t){i.save(),i.fillStyle="rgba(0, 0, 0, 0.6)",i.fillRect(10,10,120,40),i.strokeStyle="#FFD700",i.lineWidth=2,i.strokeRect(10,10,120,40),i.fillStyle="#FFFFFF",i.font="bold 24px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText(`Level ${t}`,70,30),i.restore()}drawGround(i,t){i.save();const e=1200;i.strokeStyle="#654321",i.lineWidth=3,i.beginPath(),i.moveTo(0,t),i.lineTo(e,t),i.stroke(),i.restore()}drawTitanic(i,t,e){i.save(),i.fillStyle="#2C3E50",i.beginPath(),i.moveTo(t,e),i.lineTo(t+180,e),i.lineTo(t+170,e+40),i.lineTo(t+10,e+40),i.closePath(),i.fill(),i.fillStyle="#34495E",i.fillRect(t+30,e-30,120,30),i.fillStyle="#E74C3C";const s=12,h=20,r=22,n=t+50;for(let l=0;l<4;l++)i.fillRect(n+l*r,e-50,s,h);i.fillStyle="rgba(100, 100, 100, 0.5)",i.beginPath();for(let l=0;l<4;l++)i.arc(n+l*r+s/2,e-55,6,0,Math.PI*2);i.fill(),i.restore()}drawExplosion(i,t,e){i.save(),[{color:"#FF6B35",radius:40,alpha:.8},{color:"#FFA500",radius:30,alpha:.7},{color:"#FFD700",radius:20,alpha:.6},{color:"#FFFF00",radius:10,alpha:.5}].forEach(({color:h,radius:r,alpha:n})=>{i.fillStyle=h,i.globalAlpha=n,i.beginPath(),i.arc(t,e,r,0,Math.PI*2),i.fill()}),i.globalAlpha=.9;for(let h=0;h<12;h++){const r=Math.PI*2*h/12,n=50,l=t+Math.cos(r)*n,c=e+Math.sin(r)*n;i.fillStyle=h%2===0?"#FF6B35":"#FFD700",i.beginPath(),i.arc(l,c,5,0,Math.PI*2),i.fill()}i.restore()}drawSplitIceberg(i,t){const e=this.canvasWidth,s=e/2,h=0,r=this.waterLevel;i.save(),i.fillStyle="#E0F2F7",i.beginPath(),i.moveTo(s-e*.15-t,h),i.lineTo(s-t,h),i.lineTo(s-t,r),i.lineTo(s-e*.25-t,r),i.closePath(),i.fill(),i.fillStyle="#E0F2F7",i.beginPath(),i.moveTo(s+t,h),i.lineTo(s+e*.15+t,h),i.lineTo(s+e*.25+t,r),i.lineTo(s+t,r),i.closePath(),i.fill(),i.fillStyle="#B8D8E0",i.beginPath(),i.moveTo(s-t,h),i.lineTo(s-t/2,h),i.lineTo(s-t/2,r),i.lineTo(s-t,r),i.closePath(),i.fill(),i.beginPath(),i.moveTo(s+t/2,h),i.lineTo(s+t,h),i.lineTo(s+t,r),i.lineTo(s+t/2,r),i.closePath(),i.fill(),i.restore()}drawSinkingGhost(i,t,e){i.save();const h=1-e/this.canvasHeight*.7;i.globalAlpha=h;const r=t.y;t.y=r+e,this.drawCharacter(i,t),t.y=r,i.restore()}drawCountdown(i,t){i.save();const e=Math.max(0,t).toFixed(1);let s="#FFFFFF",h="rgba(0, 0, 0, 0.6)";t<=2?(s="#FF4444",h="rgba(255, 68, 68, 0.2)"):t<=3&&(s="#FFA500",h="rgba(255, 165, 0, 0.2)");const r=200,n=60,l=this.canvasWidth-r-20,c=20;i.fillStyle=h,i.fillRect(l,c,r,n),i.strokeStyle=s,i.lineWidth=2,i.strokeRect(l,c,r,n),i.fillStyle=s,i.font="bold 36px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText(e,l+r/2,c+n/2),i.font="12px Arial",i.fillStyle="#CCCCCC",i.fillText("Titanic arrives in",l+r/2,c+12),i.restore()}drawTimeoutGameOver(i){i.save(),i.fillStyle="rgba(0, 0, 0, 0.8)",i.fillRect(0,0,this.canvasWidth,this.canvasHeight),i.fillStyle="#FF6B6B",i.font="bold 72px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("Time's Up!",this.canvasWidth/2,this.canvasHeight/2-40),i.strokeStyle="#FFF",i.lineWidth=3,i.strokeText("Time's Up!",this.canvasWidth/2,this.canvasHeight/2-40),i.fillStyle="#FFFFFF",i.font="28px Arial",i.fillText("Press ENTER to restart",this.canvasWidth/2,this.canvasHeight/2+40),i.restore()}}const g={GRAVITY:800,JUMP_STRENGTH:-400,GROUND_Y:550,HORIZONTAL_SPEED:200},H=[{levelNumber:1,obstacleCount:2,obstacleMinSpacing:200,obstacleHeightRange:[30,40],obstacleWidthRange:[40,50],seaCreatureType:"small-fish",seaCreatureCount:2,seaCreatureSize:20,doorPosition:{x:1100,y:470}},{levelNumber:2,obstacleCount:3,obstacleMinSpacing:180,obstacleHeightRange:[35,50],obstacleWidthRange:[45,60],seaCreatureType:"small-fish",seaCreatureCount:3,seaCreatureSize:25,doorPosition:{x:1100,y:450}},{levelNumber:3,obstacleCount:4,obstacleMinSpacing:160,obstacleHeightRange:[40,60],obstacleWidthRange:[50,70],seaCreatureType:"large-fish",seaCreatureCount:3,seaCreatureSize:40,doorPosition:{x:1100,y:430}},{levelNumber:4,obstacleCount:5,obstacleMinSpacing:140,obstacleHeightRange:[45,65],obstacleWidthRange:[55,75],seaCreatureType:"large-fish",seaCreatureCount:4,seaCreatureSize:50,doorPosition:{x:1100,y:410}},{levelNumber:5,obstacleCount:6,obstacleMinSpacing:120,obstacleHeightRange:[50,70],obstacleWidthRange:[60,80],seaCreatureType:"shark",seaCreatureCount:4,seaCreatureSize:70,doorPosition:{x:1100,y:390}},{levelNumber:6,obstacleCount:7,obstacleMinSpacing:100,obstacleHeightRange:[55,75],obstacleWidthRange:[65,85],seaCreatureType:"shark",seaCreatureCount:5,seaCreatureSize:90,doorPosition:{x:1100,y:370},chalicePosition:{x:650,y:500}}];function b(o){const i=Math.max(1,Math.min(6,o));return H[i-1]}class O{constructor(i,t){a(this,"canvasWidth");a(this,"canvasHeight");a(this,"waterLevel");this.canvasWidth=i,this.canvasHeight=t,this.waterLevel=t*.1}getIcebergBounds(i){const t=i===1?0:this.waterLevel,e=i===1?this.waterLevel:this.canvasHeight;return{leftEdge:0,rightEdge:this.canvasWidth,topY:t,bottomY:e,getWidthAtY:s=>this.getWidthAtDepth(s,i)}}getWidthAtDepth(i,t){const e=this.canvasWidth/2;if(t===1){const h=.3+i/this.waterLevel*.2,r=this.canvasWidth*h/2;return{left:e-r,right:e+r}}else{const s=i-this.waterLevel,h=this.canvasHeight-this.waterLevel,n=.5+s/h*.3,l=this.canvasWidth*n/2;return{left:e-l,right:e+l}}}isWithinBounds(i,t,e,s,h){const r=this.getIcebergBounds(h);if(t<r.topY||t+s>r.bottomY)return!1;const n=t+s/2,{left:l,right:c}=r.getWidthAtY(n);return i>=l&&i+e<=c}generateTrapdoor(i){const t=this.getIcebergBounds(i),e=g.GROUND_Y,{left:s,right:h}=t.getWidthAtY(e),r=80,n=20,l=s,c=h-r;if(c<l){const u=(s+h-r)/2;return new P(u,e-n)}const d=l+Math.random()*(c-l);return new P(d,e-n)}generateChalice(i){if(i!==6)return null;const t=b(i);return t.chalicePosition?new B(t.chalicePosition.x,t.chalicePosition.y):null}generateObstacles(i){const t=b(i),e=[],s=g.GROUND_Y,n=t.doorPosition.x-100,l=100,d=n-l;if(d<=0)return e;const u=(t.obstacleWidthRange[0]+t.obstacleWidthRange[1])/2,y=t.obstacleCount*u,p=d-y,f=Math.max(t.obstacleMinSpacing,p/(t.obstacleCount+1));let m=l+f;for(let S=0;S<t.obstacleCount;S++){const v=t.obstacleWidthRange[0]+Math.random()*(t.obstacleWidthRange[1]-t.obstacleWidthRange[0]),w=t.obstacleHeightRange[0]+Math.random()*(t.obstacleHeightRange[1]-t.obstacleHeightRange[0]),T=m,R=s-w;if(T+v>n)break;const A=Math.abs(g.JUMP_STRENGTH)*Math.abs(g.JUMP_STRENGTH)/(2*g.GRAVITY);w<=A*.8&&e.push(new M(T,R,v,w,"block")),m+=v+f}return e}generateDoor(i){if(i>=6)return null;const t=b(i),h=g.GROUND_Y-80;return new k(t.doorPosition.x,h)}getLevelData(i){const t=this.getIcebergBounds(i),e=t.bottomY-30;return{levelNumber:i,icebergBounds:t,trapdoorPosition:{x:0,y:e},chalicePosition:i===2?{x:0,y:0}:void 0,floorY:e}}}class E{checkBoundary(i,t){const e=i.getBounds(),s=5;if(e.y<t.topY-s||e.y+e.height>t.bottomY+s)return!1;const h=e.y+e.height/2,{left:r,right:n}=t.getWidthAtY(h);return e.x>=r-s&&e.x+e.width<=n+s}checkTrapdoorOverlap(i,t){return t.checkOverlap(i)}checkChaliceCollision(i,t){return t.checkCollision(i)}checkObstacleCollision(i,t){return t.checkCollision(i)}checkObstacleTopCollision(i,t){const e=t.checkCollision(i);return e.collided&&e.side==="top"}resolveObstacleCollision(i,t){const e=t.checkCollision(i);if(!(!e.collided||!e.side))switch(e.side){case"top":this.resolveTopCollision(i,t);break;case"bottom":this.resolveBottomCollision(i,t);break;case"left":this.resolveLeftCollision(i,t);break;case"right":this.resolveRightCollision(i,t);break}}resolveLeftCollision(i,t){const e=t.getBounds();i.x=e.x-i.width}resolveRightCollision(i,t){const e=t.getBounds();i.x=e.x+e.width}resolveTopCollision(i,t){const e=t.getBounds();i.y=e.y-i.height,i.land()}resolveBottomCollision(i,t){const e=t.getBounds();i.y=e.y+e.height,i.velocityY=0}checkDoorOverlap(i,t){return t.checkOverlap(i)}}class G{constructor(i,t){a(this,"particles");a(this,"canvasWidth");a(this,"canvasHeight");a(this,"burstCount");a(this,"nextBurstTime");a(this,"elapsedTime");this.particles=[],this.canvasWidth=i,this.canvasHeight=t,this.burstCount=0,this.nextBurstTime=0,this.elapsedTime=0}initialize(){this.particles=[],this.burstCount=0,this.nextBurstTime=0,this.elapsedTime=0}createBurst(i,t,e=50){const s=["#FF0000","#FF7F00","#FFFF00","#00FF00","#0000FF","#4B0082","#9400D3"];for(let h=0;h<e;h++){const r=Math.PI*2*h/e,n=100+Math.random()*100;this.particles.push({x:i,y:t,vx:Math.cos(r)*n,vy:Math.sin(r)*n,color:s[Math.floor(Math.random()*s.length)],life:1,maxLife:1})}}update(i){if(this.elapsedTime+=i,this.burstCount<5&&this.elapsedTime>=this.nextBurstTime){const t=this.canvasWidth*(.2+Math.random()*.6),e=this.canvasHeight*(.2+Math.random()*.4);this.createBurst(t,e),this.burstCount++,this.nextBurstTime=this.elapsedTime+.5}for(let t=this.particles.length-1;t>=0;t--){const e=this.particles[t];e.x+=e.vx*i,e.y+=e.vy*i,e.vy+=200*i,e.life-=i*.8,e.life<=0&&this.particles.splice(t,1)}}getParticles(){return this.particles}isActive(){return this.particles.length>0||this.burstCount<5}}class X{constructor(){a(this,"gravity");a(this,"terminalVelocity");this.gravity=800,this.terminalVelocity=600}applyGravity(i,t){i.applyGravity(t)}checkGroundCollision(i,t){return i.y+i.height>=t&&i.velocityY>=0?(i.y=t-i.height,i.land(),!0):!1}resolveCollision(i,t,e){const s=t.getBounds();switch(e){case"top":i.y=s.y-i.height,i.land();break;case"bottom":i.y=s.y+s.height,i.velocityY=0;break;case"left":i.x=s.x-i.width;break;case"right":i.x=s.x+s.width;break}}checkObstacleCollisions(i,t){let e=!1;for(const s of t){const h=s.checkCollision(i);h.collided&&h.side&&(this.resolveCollision(i,s,h.side),h.side==="top"&&(e=!0))}if(!e&&i.isOnGround&&t.length>0){const s=i.y+i.height;let h=!1;for(const l of t){const c=l.getBounds(),d=i.x+i.width/2;if(d>=c.x&&d<=c.x+c.width&&Math.abs(s-c.y)<5){h=!0;break}}const n=s>=550-5;!h&&!n&&(i.isOnGround=!1,i.isJumping=!0)}}}class N{constructor(i){a(this,"timeRemaining");a(this,"isActive");a(this,"hasTriggered");a(this,"timeoutDuration");this.timeoutDuration=i,this.timeRemaining=i,this.isActive=!1,this.hasTriggered=!1}start(){this.isActive=!0,this.hasTriggered=!1}stop(){this.isActive=!1}reset(){this.timeRemaining=this.timeoutDuration,this.isActive=!1,this.hasTriggered=!1}update(i){return!this.isActive||this.hasTriggered?!1:(this.timeRemaining-=i,this.timeRemaining<0&&(this.timeRemaining=0),this.timeRemaining<=0&&!this.hasTriggered?(this.hasTriggered=!0,this.isActive=!1,!0):!1)}getTimeRemaining(){return this.timeRemaining}isTimedOut(){return this.hasTriggered}isTimerActive(){return this.isActive}}class _{constructor(i,t){a(this,"stages");a(this,"currentStageIndex");a(this,"titanicX");a(this,"titanicY");a(this,"icebergSplitOffset");a(this,"ghostSinkY");a(this,"isComplete");a(this,"canvasWidth");a(this,"canvasHeight");this.canvasWidth=i,this.canvasHeight=t,this.stages=[{name:"titanic-approach",duration:2,elapsed:0},{name:"collision",duration:.5,elapsed:0},{name:"iceberg-split",duration:1,elapsed:0},{name:"ghost-sink",duration:2,elapsed:0}],this.currentStageIndex=-1,this.titanicX=-200,this.titanicY=t*.1,this.icebergSplitOffset=0,this.ghostSinkY=0,this.isComplete=!1}start(){this.currentStageIndex=0,this.isComplete=!1;for(const i of this.stages)i.elapsed=0;this.titanicX=-200,this.titanicY=this.canvasHeight*.1,this.icebergSplitOffset=0,this.ghostSinkY=0}update(i){if(this.isComplete||this.currentStageIndex<0)return;const t=this.stages[this.currentStageIndex];switch(t.elapsed+=i,t.name){case"titanic-approach":const e=t.elapsed/t.duration;this.titanicX=-200+(this.canvasWidth/2-100)*Math.min(e,1);break;case"collision":const s=t.elapsed/t.duration,h=Math.sin(s*Math.PI*10)*5,r=this.canvasWidth/2-100,n=this.canvasWidth/2-80,l=r+(n-r)*Math.min(s,1);this.titanicX=l+h;break;case"iceberg-split":const c=t.elapsed/t.duration;this.icebergSplitOffset=50*Math.min(c,1);break;case"ghost-sink":const d=t.elapsed/t.duration;this.ghostSinkY=this.canvasHeight*Math.min(d,1);break}t.elapsed>=t.duration&&(this.currentStageIndex++,this.currentStageIndex>=this.stages.length&&(this.isComplete=!0))}isAnimationComplete(){return this.isComplete}getCurrentStage(){return this.currentStageIndex<0||this.currentStageIndex>=this.stages.length?null:this.stages[this.currentStageIndex]}getTitanicPosition(){return{x:this.titanicX,y:this.titanicY}}getIcebergSplitOffset(){return this.icebergSplitOffset}getGhostSinkY(){return this.ghostSinkY}reset(){this.currentStageIndex=-1,this.isComplete=!1;for(const i of this.stages)i.elapsed=0;this.titanicX=-200,this.titanicY=this.canvasHeight*.1,this.icebergSplitOffset=0,this.ghostSinkY=0}}class z{constructor(i){a(this,"canvas");a(this,"context");a(this,"character");a(this,"inputHandler");a(this,"renderer");a(this,"levelManager");a(this,"collisionDetector");a(this,"fireworksSystem");a(this,"physicsSystem");a(this,"timeoutManager");a(this,"titanicAnimationSystem");a(this,"gameStatus");a(this,"isRunning");a(this,"currentLevel");a(this,"trapdoor");a(this,"chalice");a(this,"obstacles");a(this,"door");a(this,"seaCreatures");a(this,"lastFrameTime");a(this,"animationFrameId");a(this,"cameraX");a(this,"cameraY");a(this,"isFalling");a(this,"fallingTimer");this.canvas=i;const t=i.getContext("2d");if(!t)throw new Error("Failed to get canvas 2D context");this.context=t,this.inputHandler=new D,this.renderer=new I(i.width,i.height),this.levelManager=new O(i.width,i.height),this.collisionDetector=new E,this.fireworksSystem=new G(i.width,i.height),this.physicsSystem=new X,this.timeoutManager=new N(5),this.titanicAnimationSystem=new _(i.width,i.height),this.gameStatus="playing",this.isRunning=!1,this.currentLevel=0,this.trapdoor=null,this.chalice=null,this.obstacles=[],this.door=null,this.seaCreatures=[],this.lastFrameTime=0,this.animationFrameId=null,this.cameraX=0,this.cameraY=0,this.isFalling=!1,this.fallingTimer=0;const e=40,s=35,h=i.height*.1,r=i.width/2-s/2,n=h*.5-e;this.character=new W(r,n,s,e,g.HORIZONTAL_SPEED,i.width,0),this.initializeLevel(0)}initializeLevel(i){if(this.currentLevel=i,this.character.setLevel(i),i===0){this.obstacles=[],this.chalice=null;const t=this.canvas.height*.1,e=-120+Math.random()*190,s=this.canvas.width/2+e,h=t-80;this.door=new k(s,h,60,80),this.seaCreatures=[];for(let r=0;r<3;r++)this.seaCreatures.push(new C(1,this.canvas.width,this.canvas.height));this.character.x=this.canvas.width/2-this.character.width/2,this.character.y=t-this.character.height,this.character.velocityY=0,this.character.isJumping=!1,this.character.isOnGround=!0,this.timeoutManager.start()}else{this.obstacles=this.levelManager.generateObstacles(i),this.door=this.levelManager.generateDoor(i),this.chalice=this.levelManager.generateChalice(i),this.seaCreatures=[];for(let t=0;t<i+1;t++)this.seaCreatures.push(new C(i,this.canvas.width,this.canvas.height));this.character.x=50,this.character.y=g.GROUND_Y-this.character.height,this.character.velocityY=0,this.character.isJumping=!1,this.character.isOnGround=!0}this.trapdoor=null}transitionToLevel(i){const t=Math.max(1,Math.min(6,i));this.currentLevel===0&&t>0&&this.timeoutManager.stop(),this.gameStatus="transitioning",setTimeout(()=>{this.initializeLevel(t),this.gameStatus="playing"},300)}triggerWin(){this.gameStatus="won",this.fireworksSystem.initialize()}triggerLose(){this.gameStatus="lost"}handleTimeout(){this.gameStatus="timeout-animating",this.titanicAnimationSystem.start()}restartFromTimeout(){this.gameStatus="playing",this.timeoutManager.reset(),this.titanicAnimationSystem.reset(),this.initializeLevel(0),this.timeoutManager.start()}updateCamera(){if(this.currentLevel===0){this.cameraX=0,this.cameraY=0;return}const i=this.character.x-this.canvas.width/2+this.character.width/2,t=.15;this.cameraX+=(i-this.cameraX)*t;const s=1200-this.canvas.width;this.cameraX=Math.max(0,Math.min(this.cameraX,s)),this.cameraY=0}start(){this.isRunning||(this.isRunning=!0,this.inputHandler.initialize(),this.lastFrameTime=performance.now(),this.gameLoop(this.lastFrameTime))}stop(){this.isRunning=!1,this.inputHandler.cleanup(),this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}gameLoop(i){if(!this.isRunning)return;const t=(i-this.lastFrameTime)/1e3;this.lastFrameTime=i,this.update(t),this.render(),this.animationFrameId=requestAnimationFrame(e=>this.gameLoop(e))}update(i){if(this.inputHandler.update(),this.isFalling){this.fallingTimer+=i,this.character.y+=200*i,this.character.updateRotationOnly(i),this.fallingTimer>2&&(this.isFalling=!1,this.triggerLose());return}if(this.gameStatus==="playing")if(this.currentLevel===0){const t=this.inputHandler.getActiveDirection();t&&this.character.move(t,i),this.character.updateRotationOnly(i);for(const r of this.seaCreatures)r.update(i,this.canvas.width);if(this.timeoutManager.update(i)){this.handleTimeout();return}const s=this.canvas.width*.25,h=this.canvas.width*.75;(this.character.x<s||this.character.x+this.character.width>h)&&(this.isFalling||(this.isFalling=!0,this.fallingTimer=0)),this.door&&this.collisionDetector.checkDoorOverlap(this.character,this.door)&&this.inputHandler.isEnterPressed()&&(this.inputHandler.consumeEnter(),this.transitionToLevel(1))}else{this.inputHandler.isSpacePressed()&&this.character.isOnGround&&(this.character.jump(),this.inputHandler.consumeSpace());const t=this.inputHandler.getActiveDirection();t&&this.character.move(t,i),this.character.updatePhysics(i),this.physicsSystem.checkGroundCollision(this.character,g.GROUND_Y),this.checkCollisions(),this.updateCamera();for(const e of this.seaCreatures)e.update(i,this.canvas.width)}else this.gameStatus==="won"?this.fireworksSystem.update(i):this.gameStatus==="timeout-animating"?(this.titanicAnimationSystem.update(i),this.titanicAnimationSystem.isAnimationComplete()&&(this.gameStatus="timeout-gameover")):this.gameStatus==="timeout-gameover"&&this.inputHandler.isEnterPressed()&&(this.inputHandler.consumeEnter(),this.restartFromTimeout())}checkCollisions(){this.physicsSystem.checkObstacleCollisions(this.character,this.obstacles),this.door&&this.collisionDetector.checkDoorOverlap(this.character,this.door)&&this.inputHandler.isEnterPressed()&&(this.inputHandler.consumeEnter(),this.transitionToLevel(this.currentLevel+1)),this.chalice&&!this.chalice.collected&&this.collisionDetector.checkChaliceCollision(this.character,this.chalice)&&(this.chalice.collected=!0,this.triggerWin());const i=0,t=1200,e=this.character.x+this.character.width;(this.character.x<i||e>t)&&(this.isFalling||(this.isFalling=!0,this.fallingTimer=0)),this.character.y>g.GROUND_Y+100&&!this.isFalling&&(this.isFalling=!0,this.fallingTimer=0)}render(){if(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentLevel===0){if(this.renderer.drawStartingArea(this.context),this.renderer.drawSeaCreatures(this.context,this.seaCreatures),this.door){const e=this.door.checkOverlap(this.character);this.renderer.drawDoor(this.context,this.door,e)}this.renderer.drawCharacter(this.context,this.character);const i=this.timeoutManager.getTimeRemaining();this.renderer.drawCountdown(this.context,i),this.context.save();const t=this.canvas.height-120;this.context.fillStyle="rgba(0, 0, 0, 0.7)",this.context.fillRect(this.canvas.width/2-200,t,400,80),this.context.strokeStyle="#FFD700",this.context.lineWidth=2,this.context.strokeRect(this.canvas.width/2-200,t,400,80),this.context.fillStyle="#FFFFFF",this.context.font="bold 28px Arial",this.context.textAlign="center",this.context.fillText("Tip of the Iceberg",this.canvas.width/2,t+30),this.context.font="18px Arial",this.context.fillText("Enter the door to begin",this.canvas.width/2,t+60),this.context.restore()}else{this.context.save(),this.context.translate(-this.cameraX,-this.cameraY),this.renderer.drawBackground(this.context,this.currentLevel),this.renderer.drawSeaCreatures(this.context,this.seaCreatures),this.renderer.drawGround(this.context,g.GROUND_Y);for(const i of this.obstacles)this.renderer.drawObstacle(this.context,i);if(this.door){const i=this.door.checkOverlap(this.character);this.renderer.drawDoor(this.context,this.door,i)}this.chalice&&this.renderer.drawChalice(this.context,this.chalice),this.renderer.drawCharacter(this.context,this.character),this.context.restore(),this.renderer.drawLevelBanner(this.context,this.currentLevel)}if(this.isFalling){this.context.save();const i=Math.max(0,1-this.fallingTimer/2);this.context.fillStyle=`rgba(70, 130, 180, ${i*.5})`;for(let t=0;t<3;t++){const e=30+this.fallingTimer*50+t*20;this.context.beginPath(),this.context.arc(this.character.x+this.character.width/2-(this.currentLevel>0?this.cameraX:0),this.character.y+this.character.height/2,e,0,Math.PI*2),this.context.strokeStyle=`rgba(100, 150, 200, ${i*.3})`,this.context.lineWidth=3,this.context.stroke()}this.context.restore()}this.gameStatus==="won"?(this.renderer.drawFireworks(this.context,this.fireworksSystem.getParticles()),this.renderer.drawWinScreen(this.context)):this.gameStatus==="lost"?this.renderer.drawLoseScreen(this.context):this.gameStatus==="timeout-animating"?this.renderTimeoutAnimation():this.gameStatus==="timeout-gameover"&&this.renderer.drawTimeoutGameOver(this.context)}renderTimeoutAnimation(){const i=this.titanicAnimationSystem.getCurrentStage();if(!i)return;this.renderer.drawStartingArea(this.context),this.renderer.drawSeaCreatures(this.context,this.seaCreatures);const t=this.titanicAnimationSystem.getTitanicPosition(),e=this.titanicAnimationSystem.getIcebergSplitOffset(),s=this.titanicAnimationSystem.getGhostSinkY();switch(i.name){case"titanic-approach":this.renderer.drawTitanic(this.context,t.x,t.y);break;case"collision":this.renderer.drawTitanic(this.context,t.x,t.y),this.renderer.drawExplosion(this.context,t.x+50,t.y);break;case"iceberg-split":this.renderer.drawTitanic(this.context,t.x,t.y),this.renderer.drawSplitIceberg(this.context,e),this.renderer.drawCharacter(this.context,this.character);return;case"ghost-sink":this.renderer.drawSplitIceberg(this.context,e),this.renderer.drawSinkingGhost(this.context,this.character,s);return}this.renderer.drawCharacter(this.context,this.character)}getState(){return{status:this.gameStatus,isRunning:this.isRunning,currentLevel:this.currentLevel,character:this.character,trapdoor:this.trapdoor,chalice:this.chalice,canvas:this.canvas,context:this.context,lastFrameTime:this.lastFrameTime}}}function F(){const o=document.getElementById("gameCanvas");if(!o){console.error("Canvas element not found");return}try{const i=new z(o);i.start(),console.log("Tip of the Iceberg - Game started successfully!"),window.game=i}catch(i){console.error("Failed to initialize game:",i)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",F):F();
